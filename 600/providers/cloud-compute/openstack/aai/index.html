<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.104.3"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=../../../../favicons/favicon.ico><link rel=apple-touch-icon href=../../../../favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=../../../../favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=../../../../favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=../../../../favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=../../../../favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=../../../../favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=../../../../favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=../../../../favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=../../../../favicons/android-192x192.png sizes=192x192><title>Check-in | Documentation</title><meta name=description content="EGI documentation"><meta property="og:title" content="Check-in"><meta property="og:description" content="Authentication and Authorization integration
"><meta property="og:type" content="article"><meta property="og:url" content="/providers/cloud-compute/openstack/aai/"><meta property="article:section" content="providers"><meta property="article:modified_time" content="2022-08-23T12:36:06+01:00"><meta property="og:site_name" content="Documentation"><meta itemprop=name content="Check-in"><meta itemprop=description content="Authentication and Authorization integration
"><meta itemprop=dateModified content="2022-08-23T12:36:06+01:00"><meta itemprop=wordCount content="2620"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Check-in"><meta name=twitter:description content="Authentication and Authorization integration
"><link rel=preload href=../../../../scss/main.min.cf17fb22ec677b25d6e0b252db304a8d9ddd90de85adc30494f93f5196259e54.css as=style><link href=../../../../scss/main.min.cf17fb22ec677b25d6e0b252db304a8d9ddd90de85adc30494f93f5196259e54.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script>
<link rel=stylesheet href=../../../../css/prism.css><link rel=stylesheet href=../../../../css/shortcodes/tabbed-panex.css><link rel=stylesheet href=../../../../css/tags.css><link rel=stylesheet href=../../../../css/egi.css><script type=text/javascript src=../../../../js/prism.js></script>
<script type=text/javascript src=../../../../js/featherlight.min.js></script>
<script type=text/javascript src=../../../../js/highlight.min.js></script>
<script type=text/javascript src=../../../../js/egi.js></script>
<script type=text/javascript src=../../../../js/github.min.js></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=../../../../><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 250 189.57"><defs><style>.cls-1{fill:#fff}</style></defs><path class="cls-1" d="M131.12 9.02c.7-5.22 5.16-9.02 10.29-9.02h0c.46.0.93.03 1.39.09h0c5.69.76 9.69 5.99 8.93 11.68h0c-.76 5.69-6 9.69-11.68 8.93h0c-5.69-.76-9.69-5.99-8.94-11.68h0z"/><path class="cls-1" d="M105.69.45c.53-.08 1.06-.12 1.59-.12h0c5.04.0 9.47 3.68 10.26 8.82h0c.87 5.68-3.02 10.98-8.7 11.85h0c-5.67.87-10.98-3.02-11.85-8.7h0c-.87-5.67 3.03-10.98 8.7-11.85h0z"/><path class="cls-1" d="M70.14 11.32c1.43-.67 2.94-1 4.43-1h0c3.9.0 7.63 2.2 9.4 5.96h0c2.45 5.19.24 11.39-4.96 13.84h0c-5.19 2.45-11.39.24-13.84-4.96h0c-2.45-5.19-.23-11.39 4.96-13.84h0z"/><path class="cls-1" d="M195.27 31.3c2.05-2.4 4.96-3.63 7.89-3.63h0c2.4.0 4.8.83 6.77 2.51h0c4.34 3.74 4.86 10.3 1.11 14.65h0c-3.74 4.36-10.3 4.86-14.66 1.12h0c-4.36-3.74-4.86-10.3-1.12-14.66h0z"/><path class="cls-1" d="M39.16 31.84c1.98-1.76 4.45-2.64 6.92-2.64h0c2.86.0 5.71 1.17 7.76 3.48h0c3.82 4.28 3.45 10.86-.83 14.68h0c-4.28 3.82-10.85 3.45-14.67-.84h0c-3.82-4.28-3.45-10.85.83-14.68h0z"/><path class="cls-1" d="M220 55.07c1.75-1.13 3.71-1.68 5.65-1.68h0c3.41.0 6.74 1.67 8.73 4.74h0c3.11 4.82 1.75 11.25-3.07 14.38h0c-4.82 3.12-11.25 1.75-14.38-3.06h0c-3.11-4.82-1.75-11.25 3.07-14.38h0z"/><path class="cls-1" d="M15.25 60.26c1.97-3.17 5.37-4.91 8.84-4.91h0c1.87.0 3.77.51 5.48 1.57h0c4.87 3.03 6.37 9.44 3.34 14.31h0c-3.03 4.88-9.44 6.37-14.31 3.34h0c-4.88-3.03-6.37-9.44-3.34-14.32h0z"/><path class="cls-1" d="M.37 94.32c1.26-4.62 5.45-7.65 10.02-7.65h0c.91.0 1.83.12 2.75.37h0c5.54 1.52 8.79 7.24 7.28 12.78h0c-1.52 5.53-7.23 8.79-12.77 7.27h0c-5.54-1.52-8.8-7.23-7.28-12.77H.37z"/><path class="cls-1" d="M129.49 30.75c.5-3.7 3.67-6.39 7.29-6.39h0c.33.0.65.02.99.06h0c4.03.54 6.86 4.25 6.32 8.28h0c-.54 4.03-4.24 6.86-8.27 6.33h0c-4.04-.54-6.88-4.25-6.34-8.28h0z"/><path class="cls-1" d="M111.45 24.67c.38-.06.75-.08 1.12-.08h0c3.58.0 6.71 2.61 7.27 6.25h0c.62 4.02-2.14 7.78-6.17 8.4h0c-4.02.62-7.78-2.15-8.4-6.17h0c-.62-4.02 2.15-7.78 6.17-8.4h0z"/><path class="cls-1" d="M153.37 35.33c1.22-2.73 3.92-4.35 6.73-4.35h0c1.01.0 2.03.21 3.01.65h0c3.71 1.67 5.37 6.03 3.7 9.74h0c-1.66 3.71-6.02 5.37-9.74 3.7h0c-3.71-1.66-5.37-6.02-3.7-9.74h0z"/><path class="cls-1" d="M86.26 32.37c1.01-.47 2.09-.7 3.14-.7h0c2.76.0 5.41 1.56 6.67 4.22h0c1.74 3.68.16 8.07-3.52 9.81h0c-3.68 1.74-8.07.17-9.81-3.51h0c-1.74-3.68-.16-8.07 3.52-9.81h0z"/><path class="cls-1" d="M174.95 46.54c1.45-1.7 3.51-2.57 5.58-2.57h0c1.7.0 3.41.58 4.8 1.78h0c3.09 2.65 3.44 7.3.79 10.39h0c-2.65 3.09-7.3 3.44-10.39.79h0c-3.09-2.65-3.44-7.3-.79-10.39h0z"/><path class="cls-1" d="M64.3 46.92c1.41-1.25 3.16-1.87 4.9-1.87h0c2.03.0 4.04.83 5.5 2.46h0c2.71 3.04 2.44 7.69-.59 10.4h0c-3.04 2.71-7.69 2.44-10.4-.59h0c-2.71-3.04-2.44-7.69.59-10.41h0z"/><path class="cls-1" d="M192.48 63.39c1.24-.8 2.63-1.19 4.01-1.19h0c2.41.0 4.77 1.18 6.18 3.36h0c2.21 3.41 1.24 7.98-2.17 10.19h0c-3.41 2.22-7.98 1.24-10.19-2.17h0c-2.21-3.41-1.24-7.98 2.17-10.19h0z"/><path class="cls-1" d="M47.35 67.06c1.4-2.24 3.8-3.48 6.27-3.48h0c1.33.0 2.67.36 3.88 1.11h0c3.46 2.15 4.52 6.7 2.37 10.15h0c-2.15 3.45-6.69 4.51-10.15 2.36h0c-3.46-2.15-4.51-6.69-2.37-10.15h0z"/><path class="cls-1" d="M36.81 91.21c.89-3.27 3.87-5.43 7.1-5.43h0c.65.0 1.3.09 1.95.26h0c3.92 1.08 6.24 5.13 5.16 9.06h0c-1.07 3.92-5.13 6.23-9.05 5.15h0c-3.92-1.07-6.23-5.12-5.16-9.04h0z"/><path class="cls-1" d="M128.15 48.47c.34-2.47 2.44-4.26 4.87-4.26h0c.22.0.44.01.66.05h0c2.69.36 4.58 2.83 4.21 5.52h0c-.35 2.69-2.83 4.58-5.52 4.22h0c-2.69-.36-4.57-2.83-4.22-5.52h0z"/><path class="cls-1" d="M116.13 44.42c.25-.04.5-.05.75-.05h0c2.39.0 4.48 1.74 4.85 4.17h0c.41 2.68-1.43 5.19-4.11 5.6h0c-2.68.41-5.19-1.43-5.6-4.11h0c-.41-2.68 1.43-5.19 4.11-5.6h0z"/><path class="cls-1" d="M144.08 51.53c.82-1.82 2.61-2.9 4.49-2.9h0c.67.0 1.36.14 2.01.44h0 0c2.48 1.11 3.58 4.01 2.47 6.49h0c-1.12 2.47-4.02 3.58-6.5 2.47h0c-2.48-1.11-3.58-4.02-2.47-6.49h0z"/><path class="cls-1" d="M99.33 49.56c.68-.32 1.39-.47 2.09-.47h0c1.84.0 3.6 1.04 4.44 2.82h0c1.16 2.45.11 5.38-2.34 6.54h0c-2.45 1.16-5.38.11-6.54-2.34h0c-1.16-2.46-.11-5.38 2.35-6.54h0z"/><path class="cls-1" d="M84.7 59.25c.94-.83 2.1-1.25 3.27-1.25h0c1.35.0 2.7.56 3.67 1.64h0c1.8 2.02 1.63 5.13-.4 6.93h0c-2.02 1.81-5.13 1.63-6.93-.39h0c-1.81-2.02-1.63-5.13.39-6.94h0z"/><path class="cls-1" d="M170.15 70.24c.82-.53 1.75-.79 2.67-.79h0c1.61.0 3.18.79 4.13 2.24h0c1.47 2.28.83 5.32-1.45 6.8h0c-2.27 1.48-5.32.82-6.8-1.45h0c-1.47-2.28-.82-5.32 1.45-6.79h0z"/><path class="cls-1" d="M178.2 84.32c.46-.14.93-.2 1.4-.2h0c2.11.0 4.07 1.38 4.7 3.53h0c.77 2.6-.72 5.33-3.33 6.1h0c-2.6.77-5.33-.72-6.1-3.32h0c-.77-2.6.72-5.33 3.33-6.1h0z"/><path class="cls-1" d="M66.36 88.78c.6-2.18 2.58-3.62 4.74-3.62h0c.43.0.87.06 1.3.18h0c2.62.72 4.16 3.42 3.44 6.03h0c-.71 2.62-3.42 4.16-6.03 3.44h0c-2.62-.72-4.16-3.42-3.44-6.03h0z"/><path class="cls-1" d="M127.18 61.35c.21-1.57 1.56-2.71 3.1-2.71h0c.13.0.27.0.42.03h0c1.71.23 2.9 1.8 2.69 3.51h0c-.23 1.71-1.81 2.91-3.52 2.68h0c-1.71-.23-2.91-1.8-2.69-3.51h0z"/><path class="cls-1" d="M119.54 58.77c.16-.02.32-.04.48-.04h0c1.51.0 2.84 1.11 3.08 2.65h0c.26 1.7-.91 3.3-2.61 3.56h0c-1.71.26-3.3-.91-3.56-2.62h0c-.26-1.7.91-3.3 2.61-3.56h0z"/><path class="cls-1" d="M137.31 63.29c.52-1.16 1.65-1.84 2.85-1.84h0c.43.0.87.09 1.29.28h0c1.57.7 2.27 2.55 1.57 4.13h0c-.71 1.57-2.56 2.28-4.13 1.57h0c-1.57-.71-2.27-2.55-1.57-4.13h0z"/><path class="cls-1" d="M99.54 68.21c.59-.53 1.34-.8 2.08-.8h0c.86.0 1.72.35 2.33 1.05h0c1.15 1.29 1.04 3.26-.25 4.41h0c-1.28 1.15-3.26 1.03-4.41-.25h0c-1.14-1.29-1.04-3.26.25-4.41h0z"/><path class="cls-1" d="M153.9 75.19c.52-.34 1.11-.5 1.69-.5h0c1.03.0 2.03.5 2.62 1.42h0c.94 1.45.53 3.39-.92 4.32h0c-1.45.94-3.38.53-4.32-.92h0c-.94-1.45-.52-3.38.92-4.32h0z"/><path class="cls-1" d="M92.36 76.74c.59-.95 1.61-1.47 2.66-1.48h0c.56.0 1.13.16 1.65.47h0c1.47.92 1.91 2.84 1 4.3h0c-.91 1.47-2.84 1.92-4.3 1.01h0c-1.46-.92-1.91-2.84-1-4.31h0z"/><path class="cls-1" d="M159.01 84.15c.3-.09.59-.13.89-.13h0c1.35.0 2.6.88 2.99 2.24h0c.49 1.66-.46 3.39-2.1 3.88h0c-1.66.49-3.39-.46-3.88-2.11h0c-.49-1.66.46-3.39 2.11-3.88h0z"/><path class="cls-1" d="M87.89 86.98c.38-1.39 1.64-2.3 3.01-2.3h0c.27.0.55.04.82.11h0c1.67.46 2.65 2.18 2.19 3.84h0c-.46 1.66-2.18 2.64-3.84 2.19h0c-1.67-.46-2.64-2.18-2.19-3.84h0z"/><path class="cls-1" d="M204.54 84.51c.69-.21 1.39-.31 2.08-.31h0c3.18.0 6.12 2.08 7.06 5.29h0c1.16 3.9-1.08 8-4.98 9.15h0c-3.91 1.14-8-1.08-9.16-4.98h0c-1.14-3.9 1.08-8 4.99-9.15h0z"/><rect class="cls-1" x="232.02" y="120.84" width="17.18" height="68.73"/><path class="cls-1" d="M24.1 155.2c0-4.74 3.85-8.59 8.6-8.59h51.98c1.21.0 2.23-.47 3.04-1.26h0c.79-.8 1.25-1.83 1.25-3.04h0c0-1.22-.47-2.23-1.25-3.04h0c-.81-.79-1.83-1.25-3.04-1.26H34.41c-4.75.0-8.98 1.91-12.11 5.02h0c-3.12 3.14-5.02 7.39-5.03 12.16h0c.01 4.78 1.91 9.02 5.03 12.16h0c3.12 3.13 7.35 5.02 12.11 5.02H106.2v17.19H34.39c-9.45.0-18.08-3.87-24.26-10.08h0C3.94 173.3.08 164.66.09 155.2h0c0-9.46 3.85-18.1 10.04-24.29h0c6.18-6.21 14.82-10.07 24.27-10.07h50.27c5.9.0 11.33 2.41 15.19 6.28h0c3.88 3.86 6.3 9.29 6.29 15.19h0c0 5.91-2.42 11.33-6.29 15.2h0c-3.85 3.86-9.27 6.28-15.17 6.28h-52c-4.75.0-8.6-3.84-8.6-8.59z"/><path class="cls-1" d="M139.47 155.2c0 4.75 3.84 8.59 8.59 8.59h51.97c1.21.0 2.24.47 3.04 1.26h0c.79.81 1.25 1.83 1.25 3.04h0c0 1.21-.47 2.23-1.25 3.03h0c-.8.79-1.83 1.25-3.04 1.26h-50.26c-4.76.0-8.98-1.89-12.11-5.02h0c-3.11-3.14-5.02-7.37-5.02-12.16h0c0-4.77 1.91-9.02 5.02-12.16h0c3.13-3.11 7.35-5.02 12.11-5.02h71.79v-17.18h-71.8c-9.45.0-18.08 3.86-24.25 10.07h0c-6.2 6.19-10.05 14.83-10.05 24.29h0c0 9.46 3.84 18.1 10.05 24.29h0c6.18 6.21 14.81 10.08 24.27 10.08h50.26c5.91.0 11.34-2.42 15.2-6.3h0c3.86-3.86 6.29-9.28 6.28-15.19h0c0-5.9-2.42-11.32-6.28-15.19h0c-3.86-3.87-9.28-6.29-15.18-6.29h-51.99c-4.75.0-8.59 3.85-8.59 8.59h0z"/><path class="cls-1" d="M250 93.22c0 5.74-4.66 10.4-10.41 10.4s-10.39-4.66-10.39-10.4 4.66-10.4 10.39-10.4S250 87.48 250 93.22z"/><path class="cls-1" d="M184.69 19.75c0 5.74-4.65 10.4-10.4 10.4s-10.39-4.66-10.39-10.4 4.65-10.4 10.39-10.4 10.4 4.66 10.4 10.4z"/><path class="cls-1" d="M167.09 62.2c0 2.71-2.2 4.91-4.91 4.91s-4.9-2.2-4.9-4.91 2.19-4.91 4.9-4.91 4.91 2.2 4.91 4.91z"/><path class="cls-1" d="M82.47 75.28c0 2.71-2.2 4.91-4.91 4.91s-4.9-2.2-4.9-4.91 2.19-4.9 4.9-4.9 4.91 2.19 4.91 4.9z"/><circle class="cls-1" cx="148.83" cy="70.08" r="3.13"/><path class="cls-1" d="M113.31 64.86c0 1.73-1.4 3.13-3.13 3.13s-3.12-1.4-3.12-3.13 1.4-3.12 3.12-3.12 3.13 1.4 3.13 3.12z"/></svg></span><span class=font-weight-bold>Documentation</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-2 mb-2 mb-lg-0"><a class=nav-link href=../../../../users/><i class='fa fa-user-friends'></i><span>For Users</span></a></li><li class="nav-item mr-2 mb-2 mb-lg-0"><a class="nav-link active" href=../../../../providers/><i class='fa fa-users-cog'></i><span class=active>For Providers</span></a></li><li class="nav-item mr-2 mb-2 mb-lg-0"><a class=nav-link href=../../../../internal/><i class='fa fa-cogs'></i><span>Internal Services</span></a></li><li class="nav-item mr-2 mb-2 mb-lg-0"><a class=nav-link href=../../../../support/><i class='fa fa-lightbulb'></i><span>Support</span></a></li><li class="nav-item mr-2 mb-2 mb-lg-0"><a class=nav-link href=../../../../about/><i class='fa fa-info'></i><span>About</span></a></li></ul></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><script>$(function(){$("#td-section-nav a").removeClass("active"),$("#td-section-nav #m-providerscloud-computeopenstackaai").addClass("active"),$("#td-section-nav #m-providerscloud-computeopenstackaai-li span").addClass("td-sidebar-nav-active-item"),$("#td-section-nav #m-providerscloud-computeopenstackaai").parents("li").addClass("active-path"),$("#td-section-nav li.active-path").addClass("show"),$("#td-section-nav li.active-path").children("input").prop("checked",!0),$("#td-section-nav #m-providerscloud-computeopenstackaai-li").siblings("li").addClass("show"),$("#td-section-nav #m-providerscloud-computeopenstackaai-li").children("ul").children("li").addClass("show"),$("#td-sidebar-menu").toggleClass("d-none")})</script><div id=td-sidebar-menu class="td-sidebar__inner d-none"><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search…" aria-label=Search… autocomplete=off data-offline-search-index-json-src=../../../../offline-search-index.26055056326e7192f25dd32f900f5827.json data-offline-search-base-href=../../../../ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-providers-li><a href=../../../../providers/ title="Service Provider Guides" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-providers><span>For Providers</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-providersjoining-li><input type=checkbox id=m-providersjoining-check>
<label for=m-providersjoining-check><a href=../../../../providers/joining/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersjoining><span>Joining EGI as a provider</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersjoiningfederated-resource-centre-li><input type=checkbox id=m-providersjoiningfederated-resource-centre-check>
<label for=m-providersjoiningfederated-resource-centre-check><a href=../../../../providers/joining/federated-resource-centre/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersjoiningfederated-resource-centre><span>Joining as a Federated Resource Centre</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersjoiningtechnology-provider-li><input type=checkbox id=m-providersjoiningtechnology-provider-check>
<label for=m-providersjoiningtechnology-provider-check><a href=../../../../providers/joining/technology-provider/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersjoiningtechnology-provider><span>Joining as a Technology Provider</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersjoiningnew-provider-li><input type=checkbox id=m-providersjoiningnew-provider-check>
<label for=m-providersjoiningnew-provider-check><a href=../../../../providers/joining/new-provider/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersjoiningnew-provider><span>Joining as a provider for existing EGI services</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersjoiningcore-service-li><input type=checkbox id=m-providersjoiningcore-service-check>
<label for=m-providersjoiningcore-service-check><a href=../../../../providers/joining/core-service/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersjoiningcore-service><span>Joining as a provider of a Core Service</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersjoiningnew-service-li><input type=checkbox id=m-providersjoiningnew-service-check>
<label for=m-providersjoiningnew-service-check><a href=../../../../providers/joining/new-service/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersjoiningnew-service><span>Introducing a new EGI service</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-providerscheck-in-li><input type=checkbox id=m-providerscheck-in-check>
<label for=m-providerscheck-in-check><a href=../../../../providers/check-in/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providerscheck-in><span>Check-in</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providerscheck-inidp-li><input type=checkbox id=m-providerscheck-inidp-check>
<label for=m-providerscheck-inidp-check><a href=../../../../providers/check-in/idp/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providerscheck-inidp><span>Identity Providers</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providerscheck-insp-li><input type=checkbox id=m-providerscheck-insp-check>
<label for=m-providerscheck-insp-check><a href=../../../../providers/check-in/sp/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providerscheck-insp><span>Service Providers</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-providerscloud-compute-li><input type=checkbox id=m-providerscloud-compute-check>
<label for=m-providerscloud-compute-check><a href=../../../../providers/cloud-compute/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providerscloud-compute><span>Cloud Compute</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providerscloud-computerequirements-li><input type=checkbox id=m-providerscloud-computerequirements-check>
<label for=m-providerscloud-computerequirements-check><a href=../../../../providers/cloud-compute/requirements/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providerscloud-computerequirements><span>Requirements</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-providerscloud-computeopenstack-li><input type=checkbox id=m-providerscloud-computeopenstack-check>
<label for=m-providerscloud-computeopenstack-check><a href=../../../../providers/cloud-compute/openstack/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providerscloud-computeopenstack><span>OpenStack</span></a></label><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providerscloud-computeopenstackaai-li><input type=checkbox id=m-providerscloud-computeopenstackaai-check>
<label for=m-providerscloud-computeopenstackaai-check><a href=../../../../providers/cloud-compute/openstack/aai/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-providerscloud-computeopenstackaai><span>Check-in</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providerscloud-computeopenstackaccounting-li><input type=checkbox id=m-providerscloud-computeopenstackaccounting-check>
<label for=m-providerscloud-computeopenstackaccounting-check><a href=../../../../providers/cloud-compute/openstack/accounting/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-providerscloud-computeopenstackaccounting><span>Accounting</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providerscloud-computeopenstackcloud-info-li><input type=checkbox id=m-providerscloud-computeopenstackcloud-info-check>
<label for=m-providerscloud-computeopenstackcloud-info-check><a href=../../../../providers/cloud-compute/openstack/cloud-info/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-providerscloud-computeopenstackcloud-info><span>Information System</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providerscloud-computeopenstackcloudkeeper-li><input type=checkbox id=m-providerscloud-computeopenstackcloudkeeper-check>
<label for=m-providerscloud-computeopenstackcloudkeeper-check><a href=../../../../providers/cloud-compute/openstack/cloudkeeper/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-providerscloud-computeopenstackcloudkeeper><span>VM Image synchronisation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providerscloud-computeopenstackgpu-li><input type=checkbox id=m-providerscloud-computeopenstackgpu-check>
<label for=m-providerscloud-computeopenstackgpu-check><a href=../../../../providers/cloud-compute/openstack/gpu/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-providerscloud-computeopenstackgpu><span>GPU flavours</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providerscloud-computeopenstackvo_config-li><input type=checkbox id=m-providerscloud-computeopenstackvo_config-check>
<label for=m-providerscloud-computeopenstackvo_config-check><a href=../../../../providers/cloud-compute/openstack/vo_config/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-providerscloud-computeopenstackvo_config><span>VO Configuration guide</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providerscloud-computeregistration-li><input type=checkbox id=m-providerscloud-computeregistration-check>
<label for=m-providerscloud-computeregistration-check><a href=../../../../providers/cloud-compute/registration/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providerscloud-computeregistration><span>GOCDB Registration</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providerscloud-computevalidation-li><input type=checkbox id=m-providerscloud-computevalidation-check>
<label for=m-providerscloud-computevalidation-check><a href=../../../../providers/cloud-compute/validation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providerscloud-computevalidation><span>Installation Validation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providerscloud-computefaq-li><input type=checkbox id=m-providerscloud-computefaq-check>
<label for=m-providerscloud-computefaq-check><a href=../../../../providers/cloud-compute/faq/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providerscloud-computefaq><span>FAQ</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-providersnotebooks-li><input type=checkbox id=m-providersnotebooks-check>
<label for=m-providersnotebooks-check><a href=../../../../providers/notebooks/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersnotebooks><span>Notebooks</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersnotebooksarchitecture-li><input type=checkbox id=m-providersnotebooksarchitecture-check>
<label for=m-providersnotebooksarchitecture-check><a href=../../../../providers/notebooks/architecture/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersnotebooksarchitecture><span>Architecture</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersnotebooksoperations-li><input type=checkbox id=m-providersnotebooksoperations-check>
<label for=m-providersnotebooksoperations-check><a href=../../../../providers/notebooks/operations/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersnotebooksoperations><span>Service Operations</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-providershigh-throughput-compute-li><input type=checkbox id=m-providershigh-throughput-compute-check>
<label for=m-providershigh-throughput-compute-check><a href=../../../../providers/high-throughput-compute/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providershigh-throughput-compute><span>High-Throughput Compute</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providershigh-throughput-computehtcondor-ce-accounting-li><input type=checkbox id=m-providershigh-throughput-computehtcondor-ce-accounting-check>
<label for=m-providershigh-throughput-computehtcondor-ce-accounting-check><a href=../../../../providers/high-throughput-compute/htcondor-ce-accounting/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providershigh-throughput-computehtcondor-ce-accounting><span>HTCondor-CE Accounting</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providershigh-throughput-computestorage-accounting-li><input type=checkbox id=m-providershigh-throughput-computestorage-accounting-check>
<label for=m-providershigh-throughput-computestorage-accounting-check><a href=../../../../providers/high-throughput-compute/storage-accounting/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providershigh-throughput-computestorage-accounting><span>Storage accounting</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providershigh-throughput-computechanging-site-bdii-li><input type=checkbox id=m-providershigh-throughput-computechanging-site-bdii-check>
<label for=m-providershigh-throughput-computechanging-site-bdii-check><a href=../../../../providers/high-throughput-compute/changing-site-bdii/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providershigh-throughput-computechanging-site-bdii><span>Changing the Site BDII</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-providersdatahub-li><input type=checkbox id=m-providersdatahub-check>
<label for=m-providersdatahub-check><a href=../../../../providers/datahub/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersdatahub><span>DataHub</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersdatahuboneprovider-li><input type=checkbox id=m-providersdatahuboneprovider-check>
<label for=m-providersdatahuboneprovider-check><a href=../../../../providers/datahub/oneprovider/ title="DataHub OneProvider" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersdatahuboneprovider><span>OneProvider</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-providersonline-storage-li><input type=checkbox id=m-providersonline-storage-check>
<label for=m-providersonline-storage-check><a href=../../../../providers/online-storage/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersonline-storage><span>Online Storage</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersonline-storageminio-oidc-li><input type=checkbox id=m-providersonline-storageminio-oidc-check>
<label for=m-providersonline-storageminio-oidc-check><a href=../../../../providers/online-storage/minio-oidc/ title="Access MinIO with EGI Check-in Virtual Organisations" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersonline-storageminio-oidc><span>MinIO and Check-in</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-providersoperations-manuals-li><input type=checkbox id=m-providersoperations-manuals-check>
<label for=m-providersoperations-manuals-check><a href=../../../../providers/operations-manuals/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manuals><span>Operations manuals and How-Tos</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersoperations-manualsoperations-start-guide-li><input type=checkbox id=m-providersoperations-manualsoperations-start-guide-check>
<label for=m-providersoperations-manualsoperations-start-guide-check><a href=../../../../providers/operations-manuals/operations-start-guide/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manualsoperations-start-guide><span>Operations Start Guide</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersoperations-manualsintegration-checklist-li><input type=checkbox id=m-providersoperations-manualsintegration-checklist-check>
<label for=m-providersoperations-manualsintegration-checklist-check><a href=../../../../providers/operations-manuals/integration-checklist/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manualsintegration-checklist><span>Resource Centre Integration Check List</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersoperations-manualsman01_how_to_publish_site_information-li><input type=checkbox id=m-providersoperations-manualsman01_how_to_publish_site_information-check>
<label for=m-providersoperations-manualsman01_how_to_publish_site_information-check><a href=../../../../providers/operations-manuals/man01_how_to_publish_site_information/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manualsman01_how_to_publish_site_information><span>MAN01 How to publish site information</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersoperations-manualsman02_service_intervention_management-li><input type=checkbox id=m-providersoperations-manualsman02_service_intervention_management-check>
<label for=m-providersoperations-manualsman02_service_intervention_management-check><a href=../../../../providers/operations-manuals/man02_service_intervention_management/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manualsman02_service_intervention_management><span>MAN02 Service intervention management</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersoperations-manualsman04_tool_intervention_management-li><input type=checkbox id=m-providersoperations-manualsman04_tool_intervention_management-check>
<label for=m-providersoperations-manualsman04_tool_intervention_management-check><a href=../../../../providers/operations-manuals/man04_tool_intervention_management/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manualsman04_tool_intervention_management><span>MAN04 Tool Intervention Management</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersoperations-manualsman05_top_and_site_bdii_high_availability-li><input type=checkbox id=m-providersoperations-manualsman05_top_and_site_bdii_high_availability-check>
<label for=m-providersoperations-manualsman05_top_and_site_bdii_high_availability-check><a href=../../../../providers/operations-manuals/man05_top_and_site_bdii_high_availability/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manualsman05_top_and_site_bdii_high_availability><span>MAN05 top and site BDII High Availability</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersoperations-manualsman06_failover_for_mysql_grid_based_services-li><input type=checkbox id=m-providersoperations-manualsman06_failover_for_mysql_grid_based_services-check>
<label for=m-providersoperations-manualsman06_failover_for_mysql_grid_based_services-check><a href=../../../../providers/operations-manuals/man06_failover_for_mysql_grid_based_services/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manualsman06_failover_for_mysql_grid_based_services><span>MAN06 Failover for MySQL grid-based services</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersoperations-manualsman07_voms_replication-li><input type=checkbox id=m-providersoperations-manualsman07_voms_replication-check>
<label for=m-providersoperations-manualsman07_voms_replication-check><a href=../../../../providers/operations-manuals/man07_voms_replication/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manualsman07_voms_replication><span>MAN07 VOMS Replication</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersoperations-manualsman09_accounting_data_publishing-li><input type=checkbox id=m-providersoperations-manualsman09_accounting_data_publishing-check>
<label for=m-providersoperations-manualsman09_accounting_data_publishing-check><a href=../../../../providers/operations-manuals/man09_accounting_data_publishing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manualsman09_accounting_data_publishing><span>MAN09 Accounting data publishing</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersoperations-manualshowto01_using_igtf_ca_distribution-li><input type=checkbox id=m-providersoperations-manualshowto01_using_igtf_ca_distribution-check>
<label for=m-providersoperations-manualshowto01_using_igtf_ca_distribution-check><a href=../../../../providers/operations-manuals/howto01_using_igtf_ca_distribution/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manualshowto01_using_igtf_ca_distribution><span>HOWTO01 Using IGTF CA distribution</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersoperations-manualshowto02_site_certification_required_documentation-li><input type=checkbox id=m-providersoperations-manualshowto02_site_certification_required_documentation-check>
<label for=m-providersoperations-manualshowto02_site_certification_required_documentation-check><a href=../../../../providers/operations-manuals/howto02_site_certification_required_documentation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manualshowto02_site_certification_required_documentation><span>HOWTO02 Site Certification Required Documentation</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersoperations-manualshowto03_site_certification_giis_check-li><input type=checkbox id=m-providersoperations-manualshowto03_site_certification_giis_check-check>
<label for=m-providersoperations-manualshowto03_site_certification_giis_check-check><a href=../../../../providers/operations-manuals/howto03_site_certification_giis_check/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manualshowto03_site_certification_giis_check><span>HOWTO03 Site Certification GIIS Check</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersoperations-manualshowto04_site_certification_manual_tests-li><input type=checkbox id=m-providersoperations-manualshowto04_site_certification_manual_tests-check>
<label for=m-providersoperations-manualshowto04_site_certification_manual_tests-check><a href=../../../../providers/operations-manuals/howto04_site_certification_manual_tests/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manualshowto04_site_certification_manual_tests><span>HOWTO04 Site Certification Manual tests</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersoperations-manualsfaq-hepspec06-li><input type=checkbox id=m-providersoperations-manualsfaq-hepspec06-check>
<label for=m-providersoperations-manualsfaq-hepspec06-check><a href=../../../../providers/operations-manuals/faq-hepspec06/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersoperations-manualsfaq-hepspec06><span>FAQ HEP SPEC 06</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-providersrod-li><input type=checkbox id=m-providersrod-check>
<label for=m-providersrod-check><a href=../../../../providers/rod/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersrod><span>Regional Operator on Duty (ROD)</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersrodoverview-li><input type=checkbox id=m-providersrodoverview-check>
<label for=m-providersrodoverview-check><a href=../../../../providers/rod/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersrodoverview><span>Overview</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersrodduties-li><input type=checkbox id=m-providersrodduties-check>
<label for=m-providersrodduties-check><a href=../../../../providers/rod/duties/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersrodduties><span>Duties</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersrodcommunication-li><input type=checkbox id=m-providersrodcommunication-check>
<label for=m-providersrodcommunication-check><a href=../../../../providers/rod/communication/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersrodcommunication><span>Communication channels</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersrodsecurity-li><input type=checkbox id=m-providersrodsecurity-check>
<label for=m-providersrodsecurity-check><a href=../../../../providers/rod/security/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersrodsecurity><span>Dealing with security incidents</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersroddowntimes-li><input type=checkbox id=m-providersroddowntimes-check>
<label for=m-providersroddowntimes-check><a href=../../../../providers/rod/downtimes/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersroddowntimes><span>Managing downtimes</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersrodalarms-tickets-li><input type=checkbox id=m-providersrodalarms-tickets-check>
<label for=m-providersrodalarms-tickets-check><a href=../../../../providers/rod/alarms-tickets/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersrodalarms-tickets><span>Handling alarms and tickets</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-providersrodfaq-li><input type=checkbox id=m-providersrodfaq-check>
<label for=m-providersrodfaq-check><a href=../../../../providers/rod/faq/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-providersrodfaq><span>FAQ</span></a></label></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta pb-1 pt-2 mb-0"><a href=https://github.com/EGI-Federation/documentation/edit/main/content/en/providers/cloud-compute/openstack/aai.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/EGI-Federation/documentation/new/main/content/en/providers/cloud-compute/openstack/aai.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/EGI-Federation/documentation/issues/new?title=Check-in" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a></div><div class=td-toc><p class=td-toc-title>On this page</p><hr class=panel-line><nav id=TableOfContents><ul><li><a href=#registration-into-check-in-demo-instance>Registration into Check-in demo instance</a></li><li><a href=#keystone-setup>Keystone setup</a><ul><li><a href=#pre-requisites>Pre-requisites</a></li></ul></li><li><a href=#apache-configuration>Apache Configuration</a></li><li><a href=#keystone-configuration>Keystone Configuration</a></li><li><a href=#keystone-federation-support>Keystone Federation Support</a></li><li><a href=#horizon-configuration>Horizon Configuration</a></li><li><a href=#cli-access>CLI Access</a></li><li><a href=#additional-vos>Additional VOs</a></li><li><a href=#multiple-oidc-providers>Multiple OIDC providers</a><ul><li><a href=#mod_auth_openidc-configuration><code>mod_auth_openidc</code> configuration</a></li><li><a href=#esaco-configuration>ESACO configuration</a></li></ul></li><li><a href=#moving-to-egi-check-in-production-instance>Moving to EGI Check-in production instance</a></li><li><a href=#client-migration-to-keycloak>Client Migration to Keycloak</a><ul><li><a href=#changes-in-apache-configuration>Changes in Apache configuration</a></li><li><a href=#keystone-configuration-1>Keystone configuration</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=../../../../providers/>For Providers</a></li><li class=breadcrumb-item><a href=../../../../providers/cloud-compute/>Cloud Compute</a></li><li class=breadcrumb-item><a href=../../../../providers/cloud-compute/openstack/>OpenStack</a></li><li class="breadcrumb-item active" aria-current=page><a href=../../../../providers/cloud-compute/openstack/aai/>Check-in</a></li></ol></nav><div class=td-content><h1>Check-in</h1><div class=lead>Authentication and Authorization integration</div><header class=article-meta></header><p>The integration of OpenStack service providers into the EGI Check-in is a
two-step process:</p><ol><li>Test integration with the demo instance of EGI Check-in. This will allow you
to check the complete functionality of the system without affecting the
production Check-in service.</li><li>Once the integration is working correctly, register your provider with the
production instance of EGI Check-in to allow members of the EGI User
Community to access your service.</li></ol><h2 id=registration-into-check-in-demo-instance>Registration into Check-in demo instance</h2><p>Before your service can use the EGI Check-in OIDC Provider for user login, you
need to register a client through the
<a href=https://aai.egi.eu/federation>EGI Federation Registry</a> in order to obtain
OAuth2.0 credentials and register one or more redirect URIs.</p><p>Make sure that you fill in the following options:</p><ul><li><p><em>General</em> tab:</p><blockquote><ul><li>Set <em>Integration Environment</em> to <em>Demo</em> and fill the form with the
information about your Service.</li></ul></blockquote></li><li><p><em>Protocol Specific</em> tab:</p><blockquote><ul><li>Set <em>Select Protocol</em> to <em>OIDC Service</em></li><li>Set redirect URL to
<code>https://&lt;your keystone endpoint>/v3/auth/OS-FEDERATION/websso/openid/redirect</code>.
Recent versions of OpenStack may deploy Keystone at <code>/identity/</code>, be sure
to include that in the <code>&lt;your keystone endpoint></code> part of the URL if
needed.</li><li>Enable <em>openid</em>, <em>profile</em>, <em>email</em>, <em>eduperson_entitlement</em> in the
<strong>Scope</strong> field</li><li>Enable <em>authorization code</em> in the <strong>Grant Types</strong> field</li><li>Set <em>Proof Key for Code Exchange (PKCE) Code Challenge Method</em> to <em>SHA-256
hash algorithm (recommended)</em></li><li>Make sure <em>Allow calls to the Introspection Endpoint?</em> is enabled in
<strong>Introspection</strong> field</li></ul></blockquote></li></ul><p>Submit the request for review by the Check-in operations team. Once the request
has been approved, you will get a client ID and client secret. Save them for the
following steps</p><h2 id=keystone-setup>Keystone setup</h2><h3 id=pre-requisites>Pre-requisites</h3><ol><li>Keystone must run as a WSGI application behind an HTTP server (Apache is used
in this documentation, but any server should be possible if it has OpenID
connect/OAuth2.0 support). Keystone project has deprecated eventlet, so you
should be already running Keystone in such way.</li><li>Keystone must be run with SSL</li><li>You need to install
<a href=https://github.com/pingidentity/mod_auth_openidc>mod_auth_openidc</a> for
adding support for OpenID Connect to Apache.</li></ol><div class="alert alert-info" role=alert><h4 class=alert-heading>IGTF CAs</h4><p>EGI monitoring checks that your
Keystone accepts clients with certificates from the IGTF CAs. Please ensure that
your server is configured with the correct Certificate and Revocation path:</p><dl><dt>For Apache HTTPd</dt><dd><p>HTTPd is able to use CAs and CRLs contained in a directory:</p></dd></dl><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ApacheConf data-lang=ApacheConf><span style=display:flex><span><span style=color:#204a87>SSLCACertificatePath</span>    <span style=color:#4e9a06>/etc/grid-security/certificates</span>
</span></span><span style=display:flex><span><span style=color:#204a87>SSLCARevocationPath</span>     <span style=color:#4e9a06>/etc/grid-security/certificates</span>
</span></span></code></pre></div><dl><dt>For haproxy</dt><dd><p>CA and CRLS have to be bundled into one file.</p></dd></dl><p>Client verification should be set as optional otherwise accepted CAs won't be
presented to the EGI monitoring:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span># crt: concatenated cert, key and CA
</span></span><span style=display:flex><span># ca-file: all IGTF CAs, concatenated as one file
</span></span><span style=display:flex><span># crl-file: all IGTF CRLs, concatenated as one file
</span></span><span style=display:flex><span># verify: enable optional X.509 client authentication
</span></span><span style=display:flex><span>bind XXX.XXX.XXX.XXX:443 ssl crt /etc/haproxy/certs/host-cert-with-key-and-ca.pem ca-file /etc/haproxy/certs/igtf-cas-bundle.pem crl-file /etc/haproxy/certs/igtf-crls-bundle.pem verify optional
</span></span></code></pre></div><dl><dt>For nginx</dt><dd><p>CA and CRLS have to be bundled into one file.</p></dd></dl><p>Client verification should be set as optional otherwise accepted CAs won't be
presented to the EGI monitoring:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Nginx data-lang=Nginx><span style=display:flex><span><span style=color:#204a87;font-weight:700>ssl_client_certificate</span> <span style=color:#4e9a06>/etc/ssl/certs/igtf-cas-bundle.pem</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ssl_crl</span> <span style=color:#4e9a06>/etc/ssl/certs/igtf-crls-bundle.pem</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ssl_verify_client</span> <span style=color:#4e9a06>optional</span><span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><dl><dt>Managing IGTF CAs and CRLs</dt><dd><p>IGTF CAs can be obtained from UMD, you can find repository files for your
distribution at
<a href=https://repository.egi.eu/sw/production/cas/1/current/>EGI CA repository</a></p></dd></dl><p>IGTF CAs and CRLs can be bundled using the examples command hereafter.</p><p>Please update CAs bundle after IGTF updates, and CRLs bundle after each CRLs
update made by fetch-crl:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat /etc/grid-security/certificates/*.pem &gt; /etc/haproxy/certs/igtf-cas-bundle.pem
</span></span><span style=display:flex><span>cat /etc/grid-security/certificates/*.r0 &gt; /etc/haproxy/certs/igtf-crls-bundle.pem
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Some CRLs files are not ending with a new line</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Ensuring that CRLs markers are separated by a line feed</span>
</span></span><span style=display:flex><span>perl -pe <span style=color:#4e9a06>&#39;s/----------/-----\n-----/&#39;</span> -i /etc/haproxy/certs/igtf-crls-bundle.pem
</span></span></code></pre></div></div><h2 id=apache-configuration>Apache Configuration</h2><p>Include this configuration on the Apache config for the virtual host of your
Keystone service, using the client ID and secret obtained above:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ApacheConf data-lang=ApacheConf><span style=display:flex><span><span style=color:#204a87>OIDCResponseType</span> <span style=color:#4e9a06>&#34;code&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCClaimPrefix</span> <span style=color:#4e9a06>&#34;OIDC-&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCClaimDelimiter</span> ;
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCScope</span> <span style=color:#4e9a06>&#34;openid profile email eduperson_entitlement&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCProviderMetadataURL</span> https://aai-demo.egi.eu/auth/realms/egi/.well-known/openid-configuration
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCClientID</span> &lt;client id&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCClientSecret</span> &lt;client secret&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCCryptoPassphrase</span> &lt;some crypto pass phrase&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCRedirectURI</span> https://&lt;your keystone endpoint&gt;/v3/auth/OS-FEDERATION/websso/openid/redirect
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># OAuth for CLI access</span>
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCOAuthIntrospectionEndpoint</span> https://aai-demo.egi.eu/auth/realms/egi/protocol/openid-connect/token/introspect
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCOAuthClientID</span> &lt;client id&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCOAuthClientSecret</span> &lt;client secret&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Increase Shm cache size for supporting long entitlements</span>
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCCacheShmEntrySizeMax</span> <span style=color:#0000cf;font-weight:700>65536</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;Location</span> <span style=color:#4e9a06>~ &#34;/v3/auth/OS-FEDERATION/websso/openid&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87>AuthType</span> openid-connect
</span></span><span style=display:flex><span>        <span style=color:#204a87>Require</span> valid-user
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/Location&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;Location</span> <span style=color:#4e9a06>~ &#34;/v3/OS-FEDERATION/identity_providers/egi.eu/protocols/openid/auth&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87>Authtype</span> oauth20
</span></span><span style=display:flex><span>        <span style=color:#204a87>Require</span> valid-user
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/Location&gt;</span>
</span></span></code></pre></div><p>If you have multiple keystone hosts, configure an alternative caching mechanism
as per <a href=https://github.com/zmartzone/mod_auth_openidc/wiki/Caching>https://github.com/zmartzone/mod_auth_openidc/wiki/Caching</a></p><p>For example, using memcache</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ApacheConf data-lang=ApacheConf><span style=display:flex><span><span style=color:#204a87>OIDCCacheType</span> memcache
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCMemCacheServers</span> <span style=color:#4e9a06>&#34;memcache1 memcache2 memcache3&#34;</span>
</span></span></code></pre></div><p>Be sure to enable the <code>mod_auth_oidc</code> module in Apache, in Ubuntu:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo a2enmod auth_openidc
</span></span></code></pre></div><div class="alert alert-info" role=alert><h4 class=alert-heading>Note</h4><p>If running Keystone behind a proxy, make
sure to correctly set the X-Forwarded-Proto and X-Forwarded-Port request
headers, e.g. for haproxy:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>http-request set-header X-Forwarded-Proto https if { ssl_fc }
</span></span><span style=display:flex><span>http-request set-header X-Forwarded-Proto http if !{ ssl_fc }
</span></span><span style=display:flex><span>http-request set-header X-Forwarded-Port %[dst_port]
</span></span></code></pre></div></div><h2 id=keystone-configuration>Keystone Configuration</h2><p>Configure your <code>keystone.conf</code> to include in the <code>[auth]</code> section <code>openid</code> in
the list of authentication methods:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[auth]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># This may change in your installation</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># add openid to the list of the methods you support</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>methods</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>password, token, openid</span>
</span></span></code></pre></div><p>Add a <code>[openid]</code> section as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[openid]</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># this is the attribute in the Keystone environment that will define the</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># identity provider</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>remote_id_attribute</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>HTTP_OIDC_ISS</span>
</span></span></code></pre></div><p>Add your horizon host as trusted dashboard to the <code>[federation]</code> section:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#204a87;font-weight:700>[federation]</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>trusted_dashboard</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>https://&lt;your horizon&gt;/dashboard/auth/websso/</span>
</span></span></code></pre></div><p>Finally copy the default template for managing the tokens in horizon to
<code>/etc/keystone/sso_callback_template.html</code>. This template can be found in
keystone git repository at
<code>https://github.com/openstack/keystone/blob/master/etc/sso_callback_template.html</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl -L https://raw.githubusercontent.com/openstack/keystone/master/etc/sso_callback_template.html <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>    &gt; /etc/keystone/sso_callback_template.html
</span></span></code></pre></div><p>Now restart your Apache (and Keystone if running in uwsgi) so you can configure
the Keystone Federation support.</p><h2 id=keystone-federation-support>Keystone Federation Support</h2><p>First, create a new <code>egi.eu</code> identity provider with remote id
<code>https://aai-demo.egi.eu/auth/realms/egi</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ openstack identity provider create --remote-id https://aai-demo.egi.eu/auth/realms/egi egi.eu
</span></span><span style=display:flex><span>+-------------+-----------------------------------------+
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> Field       <span style=color:#000;font-weight:700>|</span> Value                                   <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span>+-------------+-----------------------------------------+
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> description <span style=color:#000;font-weight:700>|</span> None                                    <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> domain_id   <span style=color:#000;font-weight:700>|</span> 1cac7817dafb4740a249cc9ca6b14ea5        <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> enabled     <span style=color:#000;font-weight:700>|</span> True                                    <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> id          <span style=color:#000;font-weight:700>|</span> egi.eu                                  <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> remote_ids  <span style=color:#000;font-weight:700>|</span> https://aai-demo.egi.eu/auth/realms/egi <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span>+-------------+-----------------------------------------+
</span></span></code></pre></div><p>Create a group for users coming from EGI Check-in, usual configuration is to
have one group per VO you want to support.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ openstack group create ops
</span></span><span style=display:flex><span>+-------------+----------------------------------+
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> Field       <span style=color:#000;font-weight:700>|</span> Value                            <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span>+-------------+----------------------------------+
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> description <span style=color:#000;font-weight:700>|</span>                                  <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> domain_id   <span style=color:#000;font-weight:700>|</span> default                          <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> id          <span style=color:#000;font-weight:700>|</span> 89cf5b6708354094942d9d16f0f29f8f <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> name        <span style=color:#000;font-weight:700>|</span> ops                              <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span>+-------------+----------------------------------+
</span></span></code></pre></div><p>Add that group to the desired local project:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>openstack role add member --group ops --project ops
</span></span></code></pre></div><p>Define a mapping of users from EGI Check-in to the group just created and
restrict with the <code>OIDC-eduperson_entitlement</code> the VOs you want to support for
that group. Substitute the group ID and the allowed entitlements for the
adequate values for your deployment:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cat mapping.egi.json
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;local&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;user&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#4e9a06>&#34;name&#34;</span>: <span style=color:#4e9a06>&#34;{0}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;group&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#4e9a06>&#34;id&#34;</span>: <span style=color:#4e9a06>&#34;89cf5b6708354094942d9d16f0f29f8f&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>]</span>,
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;remote&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;HTTP_OIDC_SUB&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;HTTP_OIDC_ISS&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;any_one_of&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>                    <span style=color:#4e9a06>&#34;https://aai-demo.egi.eu/auth/realms/egi&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;OIDC-eduperson_entitlement&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;regex&#34;</span>: true,
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;any_one_of&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>                    <span style=color:#4e9a06>&#34;^urn:mace:egi.eu:group:ops:role=vm_operator#aai.egi.eu</span>$<span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p>More recent versions of Keystone allow for more elaborated mapping, but this
configuration should work for Mitaka and onwards</p><p>Create the mapping in Keystone:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ openstack mapping create --rules mapping.egi.json egi-mapping
</span></span><span style=display:flex><span>+-------+--------------------------------------------------------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> Field <span style=color:#000;font-weight:700>|</span> Value                                                                                                                                <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span>+-------+--------------------------------------------------------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> id    <span style=color:#000;font-weight:700>|</span> egi-mapping                                                                                                                          <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> rules <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>[{</span>u<span style=color:#4e9a06>&#39;remote&#39;</span>: <span style=color:#ce5c00;font-weight:700>[{</span>u<span style=color:#4e9a06>&#39;type&#39;</span>: u<span style=color:#4e9a06>&#39;HTTP_OIDC_SUB&#39;</span><span style=color:#ce5c00;font-weight:700>}</span>, <span style=color:#ce5c00;font-weight:700>{</span>u<span style=color:#4e9a06>&#39;type&#39;</span>: u<span style=color:#4e9a06>&#39;HTTP_OIDC_ISS&#39;</span>, u<span style=color:#4e9a06>&#39;any_one_of&#39;</span>: <span style=color:#ce5c00;font-weight:700>[</span>u<span style=color:#4e9a06>&#39;https://aai-demo.egi.eu/auth/realms/egi&#39;</span><span style=color:#ce5c00;font-weight:700>]}</span>, <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>{</span>u<span style=color:#4e9a06>&#39;regex&#39;</span>: True, u<span style=color:#4e9a06>&#39;type&#39;</span>: u<span style=color:#4e9a06>&#39;OIDC-eduperson_entitlement&#39;</span>, u<span style=color:#4e9a06>&#39;any_one_of&#39;</span>: <span style=color:#ce5c00;font-weight:700>[</span>u<span style=color:#4e9a06>&#39;^urn:mace:egi.eu:.*:ops:vm_operator@egi.eu$&#39;</span><span style=color:#ce5c00;font-weight:700>]}]</span>,          <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span>       <span style=color:#000;font-weight:700>|</span> u<span style=color:#4e9a06>&#39;local&#39;</span>: <span style=color:#ce5c00;font-weight:700>[{</span>u<span style=color:#4e9a06>&#39;group&#39;</span>: <span style=color:#ce5c00;font-weight:700>{</span>u<span style=color:#4e9a06>&#39;id&#39;</span>: u<span style=color:#4e9a06>&#39;89cf5b6708354094942d9d16f0f29f8f&#39;</span><span style=color:#ce5c00;font-weight:700>}</span>, u<span style=color:#4e9a06>&#39;user&#39;</span>: <span style=color:#ce5c00;font-weight:700>{</span>u<span style=color:#4e9a06>&#39;name&#39;</span>: u<span style=color:#4e9a06>&#39;{0}&#39;</span><span style=color:#ce5c00;font-weight:700>}}]}]</span>                                   <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span>+-------+--------------------------------------------------------------------------------------------------------------------------------------+
</span></span></code></pre></div><p>Finally, create the federated protocol with the identity provider and mapping
created before:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ openstack federation protocol create <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>            --identity-provider egi.eu <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>            --mapping egi-mapping openid
</span></span><span style=display:flex><span>+-------------------+-------------+
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> Field             <span style=color:#000;font-weight:700>|</span> Value       <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span>+-------------------+-------------+
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> id                <span style=color:#000;font-weight:700>|</span> openid      <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> identity_provider <span style=color:#000;font-weight:700>|</span> egi.eu      <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> mapping           <span style=color:#000;font-weight:700>|</span> egi-mapping <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span>+-------------------+-------------+
</span></span></code></pre></div><p>Keystone is now ready to accept EGI Check-in credentials.</p><h2 id=horizon-configuration>Horizon Configuration</h2><p>Edit your local_settings.py to include the following values:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Enables keystone web single-sign-on if set to True.</span>
</span></span><span style=display:flex><span><span style=color:#000>WEBSSO_ENABLED</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>True</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Allow users to choose between local Keystone credentials or login</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># with EGI Check-in</span>
</span></span><span style=display:flex><span><span style=color:#000>WEBSSO_CHOICES</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;credentials&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Keystone Credentials&#34;</span><span style=color:#000;font-weight:700>)),</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;openid&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;EGI Check-in&#34;</span><span style=color:#000;font-weight:700>)),</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Once horizon is restarted you will be able to choose "EGI Check-in" for login.</p><h2 id=cli-access>CLI Access</h2><p>The
<a href=https://docs.openstack.org/developer/python-openstackclient/>OpenStack Client</a>
has built-in support for using OpenID Connect Access Tokens to authenticate. You
first need to get a valid Access Token from EGI Check-in (e.g. from
<a href=https://aai-demo.egi.eu/token/>https://aai-demo.egi.eu/token/</a>) and then use it in a command like:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ openstack --os-auth-url https://&lt;your keystone endpoint&gt;/v3 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>            --os-auth-type v3oidcaccesstoken --os-protocol openid <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>            --os-identity-provider egi.eu <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>            --os-access-token &lt;your access token&gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>            token issue
</span></span><span style=display:flex><span>+---------+---------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> Field   <span style=color:#000;font-weight:700>|</span> Value                                                                                 <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span>+---------+---------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> expires <span style=color:#000;font-weight:700>|</span> 2017-05-23T11:24:31+0000                                                              <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> id      <span style=color:#000;font-weight:700>|</span> gAAAAABZJA3fbKX....nEMAPi-IsFOCkU9QWGTISYElzYJsI3z0SJGs7QsTJv4aJQq0JDJUBz6uE85SqXDj3  <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> user_id <span style=color:#000;font-weight:700>|</span> 020864ea9415413f9d706f6b473dbeba                                                      <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span>+---------+---------------------------------------------------------------------------------------+
</span></span></code></pre></div><h2 id=additional-vos>Additional VOs</h2><p>Configuration can include as many mappings as needed in the json file. Users
will be members of all the groups matching the remote part of the mapping. For
example this file has 2 mappings, one for members of <code>ops</code> and another for
members of <code>fedcloud.egi.eu</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;local&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;user&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;{0}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;group&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;66df3a7a0c6248cba8b729de7b042639&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;remote&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;HTTP_OIDC_SUB&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;HTTP_OIDC_ISS&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;any_one_of&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;https://aai-demo.egi.eu/auth/realms/egi&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;OIDC-eduperson_entitlement&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;regex&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;any_one_of&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>          <span style=color:#4e9a06>&#34;^urn:mace:egi.eu:group:ops:role=vm_operator#aai.egi.eu$&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;local&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;user&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;{0}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;group&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&#34;id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;e1c04284718f4e19bb0516e5534a24e8&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&#34;remote&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;HTTP_OIDC_SUB&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;HTTP_OIDC_ISS&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;any_one_of&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;https://aai-demo.egi.eu/auth/realms/egi&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;OIDC-eduperson_entitlement&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;regex&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&#34;any_one_of&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>          <span style=color:#4e9a06>&#34;^urn:mace:egi.eu:group:fedcloud.egi.eu:vm_operator:role=member#aai.egi.eu$&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>]</span>
</span></span></code></pre></div><h2 id=multiple-oidc-providers>Multiple OIDC providers</h2><p>If your OpenStack deployment needs to support multiple identity providers
(besides EGI Check-in) you will need to configure <code>mod_auth_openidc</code> to support
<a href=https://github.com/zmartzone/mod_auth_openidc/wiki/Multiple-Providers#discovery>multiple providers</a>
and use an OAuth2.0 token introspection proxy like
<a href=https://github.com/indigo-iam/esaco>ESACO</a>.</p><h3 id=mod_auth_openidc-configuration><code>mod_auth_openidc</code> configuration</h3><p>First, create a directory to host each of the providers configuration, in our
case we will use <code>/var/lib/apache2/oidc/metadata</code>, but adapt this to your
specific needs. Ensure this directory is writable by the user running apache:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir -p /var/lib/apache2/oidc/metadata
</span></span><span style=display:flex><span>chown -R www-data:www-data /var/lib/apache2/oidc/metadata
</span></span></code></pre></div><p>Set in your Apache configuration the <code>OIDCMetadataDir</code> pointing to that
directory</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ApacheConf data-lang=ApacheConf><span style=display:flex><span><span style=color:#204a87>OIDCMetadataDir</span> <span style=color:#4e9a06>/var/lib/apache2/oidc/metadata</span>
</span></span></code></pre></div><p>You may remove the <code>OIDCProviderMetadataURL</code>, <code>OIDCClientID</code> and
<code>OIDCClientSecret</code> options from the Apache configuration as these will be now
set in new files created in the metadata directory. For every provider you will
support, you need to create 3 files:</p><ol><li><p><code>&lt;urlencoded-issuer-value-with-https-prefix-and-trailing-slash-stripped>.provider</code>
with the OpenID Connect Discovery OP JSON metadata. The easiest way to create
this file is getting its content from the OIDC server itself. For EGI
Check-in:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>curl https://aai-demo.egi.eu/auth/realms/egi/.well-known/openid-configuration &gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>     /var/lib/apache2/oidc/metadata/aai-demo.egi.eu%2Foidc.provider
</span></span></code></pre></div></li><li><p><code>&lt;urlencoded-issuer-value-with-https-prefix-and-trailing-slash-stripped>.client</code>
with the client credentials. For EGI Check-in
(<code>aai-demo.egi.eu%2Foidc.client</code>):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;client_id&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&lt;your client id&gt;&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;client_secret&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&lt;your secret id&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></li><li><p><code>&lt;urlencoded-issuer-value-with-https-prefix-and-trailing-slash-stripped>.conf</code>
with any extra configuration for the provider. This may not be needed if all
your providers are similar. For example to specify the scopes to use for
Check-in, use a <code>aai-demo.egi.eu%2Foidc.conf</code> as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;scope&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;openid email profile eduperson_entitlement&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></li></ol><p>Now add for the providers you support new configuration in Apache to facilitate
the use of the dashboard. This is for a configuration of an <code>egi.eu</code> identity
provider with <code>openid</code> as protocol:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ApacheConf data-lang=ApacheConf><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;Location</span> <span style=color:#4e9a06>~ &#34;/v3/auth/OS-FEDERATION/identity_providers/egi.eu/protocols/openid/websso&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87>AuthType</span> openid-connect
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># This is your Redirect URI with a new iss=&lt;your idp iss&gt; option added</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87>OIDCDiscoverURL</span> https://&lt;your keystone endpoint&gt;/v3/auth/OS-FEDERATION/websso/openid/redirect?iss=https%3A%2F%2Faai-demo.egi.eu%2Foidc%2F
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Ensure that the user is authenticated with the expected iss</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87>Require</span> claim iss:https://aai-demo.egi.eu/auth/realms/egi
</span></span><span style=display:flex><span>        <span style=color:#204a87>Require</span> valid-user
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/Location&gt;</span>
</span></span></code></pre></div><p>In your Horizon configuration, set the list of providers and their mappings:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic># this is the list that will show up in the dropdown menu</span>
</span></span><span style=display:flex><span><span style=color:#000>WEBSSO_CHOICES</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;credentials&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Keystone Credentials&#34;</span><span style=color:#000;font-weight:700>)),</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;egi.eu&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;EGI Check-in&#34;</span><span style=color:#000;font-weight:700>)),</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;other-idp&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Other IdP&#34;</span><span style=color:#000;font-weight:700>)),</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># this maps the options above to keystone&#39;s idps and protocols</span>
</span></span><span style=display:flex><span><span style=color:#000>WEBSSO_IDP_MAPPING</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;egi.eu&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;egi.eu&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;openid&#34;</span><span style=color:#000;font-weight:700>),</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;other-idp&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;other-idp.com&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;openid&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=esaco-configuration>ESACO configuration</h3><p>ESACO will handle OAuth tokens when users hit your Keystone from API/CLI. It
needs to run as a daemon that listens (by default) on port 8156. We will use
docker for facilitating the deployment:</p><ol><li><p>Create a yaml file with the configuration of the different providers
(<code>application.yaml</code>):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>oidc</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clients</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>issuer-url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>https://aai-demo.egi.eu/auth/realms/egi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>client-id</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&lt;your check-in client id&gt;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>client-secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&lt;your check-in client secret&gt;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>issuer-url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>&lt;another idp&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>client-id</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&lt;your client id for second idp&gt;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>client-secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&lt;your client secret for second idp&gt;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></li><li><p>Create a environment file with the ESACO credentials you want to use
(<code>esaco.env</code>):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># User name credential requested from clients introspecting tokens</span>
</span></span><span style=display:flex><span><span style=color:#000>ESACO_USER_NAME</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;esaco user name&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Password  credential requested from clients introspecting tokens</span>
</span></span><span style=display:flex><span><span style=color:#000>ESACO_USER_PASSWORD</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;esaco password&gt;
</span></span></code></pre></div></li><li><p>Run the ESACO server (adapt this as it better fits to run on your servers and
make it run permanently):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -p 8156:8156 -d -env-file<span style=color:#ce5c00;font-weight:700>=</span>esaco.env <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>           -v application.yml:/esaco/config/application.yml:ro <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>           indigoiam/esaco:latest
</span></span></code></pre></div></li><li><p>Configure Keystone&rsquo;s Apache to use ESACO as OAuth introspection endpoint:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ApacheConf data-lang=ApacheConf><span style=display:flex><span><span style=color:#8f5902;font-style:italic># point this to the host where ESACO is running</span>
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCOAuthIntrospectionEndpoint</span> http://localhost:8156/introspect
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCOAuthClientID</span>              &lt;esaco <span style=color:#204a87;font-weight:700>user</span> name&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCOAuthClientSecret</span>          &lt;esaco password&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCIDTokenIatSlack</span>            <span style=color:#0000cf;font-weight:700>3600</span>
</span></span></code></pre></div></li><li><p>Configure also the locations in Apache that should use OAuth:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ApacheConf data-lang=ApacheConf><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;Location</span> <span style=color:#4e9a06>~ &#34;/v3/OS-FEDERATION/identity_providers/egi.eu/protocols/openid/auth&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#204a87>Authtype</span> oauth20
</span></span><span style=display:flex><span>     <span style=color:#204a87>Require</span> valid-user
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/Location&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;Location</span> <span style=color:#4e9a06>~ &#34;/v3/OS-FEDERATION/identity_providers/other_idp/protocols/openid/auth&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#204a87>Authtype</span> oauth20
</span></span><span style=display:flex><span>     <span style=color:#204a87>Require</span> valid-user
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/Location&gt;</span>
</span></span></code></pre></div></li></ol><h2 id=moving-to-egi-check-in-production-instance>Moving to EGI Check-in production instance</h2><p>Once tests in the development instance of Check-in are successful, you can move
to the production instance. Go to
<a href=https://aai.egi.eu/federation>EGI Federation Registry</a> and submit a Service
Request for the production instance of EGI Check-in. After the approval of the
request, you will need to update your configuration as follows:</p><ul><li><p>Update the <code>remote-id</code> of the identity provider:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>openstack identity provider <span style=color:#204a87>set</span> --remote-id https://aai.egi.eu/auth/realms/egi egi.eu
</span></span></code></pre></div></li><li><p>Update the <code>HTTP_OIDC_ISS</code> filter in your mappings, e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sed -i <span style=color:#4e9a06>&#39;s/aai-demo.egi.eu/aai.egi.eu/&#39;</span> mapping.egi.json
</span></span><span style=display:flex><span>openstack mapping <span style=color:#204a87>set</span> --rules mapping.egi.json egi-mapping
</span></span></code></pre></div></li><li><p>Update Apache configuration to use <code>aai.egi.eu</code> instead of <code>aai-demo.egi.eu</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ApacheConf data-lang=ApacheConf><span style=display:flex><span><span style=color:#204a87>OIDCProviderMetadataURL</span> https://aai.egi.eu/auth/realms/egi/.well-known/openid-configuration
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCOAuthIntrospectionEndpoint</span> https://aai.egi.eu/auth/realms/egi/protocol/openid-connect/token/introspect
</span></span></code></pre></div></li></ul><div class="alert alert-info" role=alert><h4 class=alert-heading>Changes in the client settings</h4>If you want to
make any changes to the client configuration, you need to submit a
reconfiguration request through the
<a href=https://aai.egi.eu/federation>Federation Registry</a>.</div><h2 id=client-migration-to-keycloak>Client Migration to Keycloak</h2><p>Check-in is migrating its internal implementation to Keycloak. The Development
and Demo environments already using Keycloak since June 24th 2022 and Production
environment expected to migrate during July 2022.</p><p>A general guide on migration is available on
<a href=../../../check-in/sp#client-migration-to-keycloak>Check-in documentation</a>, in
this section we provide specific information for OpenStack providers.</p><h3 id=changes-in-apache-configuration>Changes in Apache configuration</h3><p>The new Keycloak endpoint has a different URL that needs to be updated in your
apache config. You will also need to add PKCE configuration. These are the
configuration parameters and their new values:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ApacheConf data-lang=ApacheConf><span style=display:flex><span><span style=color:#8f5902;font-style:italic># update Metadata URL</span>
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCProviderMetadataURL</span> https://aai.egi.eu/auth/realms/egi/.well-known/openid-configuration
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Add PKCE method</span>
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCPKCEMethod</span> S256
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># update introspection endpoint</span>
</span></span><span style=display:flex><span><span style=color:#204a87>OIDCOAuthIntrospectionEndpoint</span> https://aai.egi.eu/auth/realms/egi/protocol/openid-connect/token/introspect
</span></span></code></pre></div><div class="alert alert-Warning" role=alert><h4 class=alert-heading>Require claim</h4><p>If you use the
<code>Require claim iss:&lt;issuer></code> in your Apache configuration to restrict the
issuer, please allow both the Keycloak and MitreID issuers during the transition
period, e.g.:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ApacheConf data-lang=ApacheConf><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;RequireAny&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>Require</span> claim iss:https://aai.egi.eu/auth/realms/egi
</span></span><span style=display:flex><span>    <span style=color:#204a87>Require</span> claim iss:https://aai.egi.eu/oidc/
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/RequireAny&gt;</span>
</span></span></code></pre></div></div><h4 id=multiple-oidc-providers-1>Multiple OIDC providers</h4><div class="alert alert-Warning" role=alert><h4 class=alert-heading>Note</h4>Configuration in this section is only
needed if you are using <code>mod_auth_oidc</code> with multiple providers</div><p>If you are using multiple OpenID Connect providers, you will need to add a new
configuration to your metadata directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ curl https://aai.egi.eu/auth/realms/egi/.well-known/openid-configuration &gt; <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>       /var/lib/apache2/oidc/metadata/aai.egi.eu%2Fauth%2Frealms%2Fegi.conf
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># copy credentials from existing client</span>
</span></span><span style=display:flex><span>$ cp /var/lib/apache2/oidc/metadata/aai.egi.eu%2Foidc.client <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>     /var/lib/apache2/oidc/metadata/aai.egi.eu%2Fauth%2Frealms%2Fegi.client
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># create configuration for the client</span>
</span></span><span style=display:flex><span>$ cat &gt;  /var/lib/apache2/oidc/metadata/aai.egi.eu%2Fauth%2Frealms%2Fegi.conf <span style=color:#4e9a06>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>{
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  &#34;scope&#34;: &#34;openid email profile eduperson_entitlement&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  &#34;pkce_method&#34;: &#34;S256&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div><p>And update your Apache configuration for the authentication with Horizon:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ApacheConf data-lang=ApacheConf><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;Location</span> <span style=color:#4e9a06>~ &#34;/v3/auth/OS-FEDERATION/identity_providers/egi.eu/protocols/openid/websso&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87>AuthType</span> openid-connect
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># This is your Redirect URI with a new iss=&lt;your idp iss&gt; option added</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87>OIDCDiscoverURL</span> https://&lt;your keystone endpoint&gt;/v3/auth/OS-FEDERATION/websso/openid/redirect?iss=https%3A%2F%2Faai.egi.eu%2Fauth%2Frealms%2Fegi
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Ensure that the user is authenticated with the expected iss</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87>Require</span> claim iss:https://aai.egi.eu/auth/realms/egi
</span></span><span style=display:flex><span>        <span style=color:#204a87>Require</span> valid-user
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/Location&gt;</span>
</span></span></code></pre></div><p>Also update ESACO to include the configuration of the new endpoint URL:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>oidc</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clients</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>issuer-url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>https://aai.egi.eu/auth/realms/egi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>client-id</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&lt;your check-in client id&gt;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>client-secret</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&lt;your check-in client secret&gt;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic># other clients</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=keystone-configuration-1>Keystone configuration</h3><p>Similarly to the change from Demo to Production described
<a href=#moving-to-egi-check-in-production-instance>above</a>, you will need to update
the URLs on your configuration:</p><ol><li><p>Update the <code>remote-id</code> of the identity provider to also include the new
issuer:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ openstack identity provider <span style=color:#204a87>set</span> --remote-id https://aai.egi.eu/auth/realms/egi --remote-id https://aai.egi.eu/oidc/ egi.eu
</span></span></code></pre></div></li><li><p>Add the new issuer to the <code>HTTP_OIDC_ISS</code> filter in your mappings, keep both
the <code>https://aai.egi.eu/oidc/</code> and <code>https://aai.egi.eu/auth/realms/egi</code> so
users can still use their existing tokens. Check-in will handle the
validation of both kind of tokens automatically. The <code>HTTP_OIDC_ISS</code> section
should look as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;type&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;HTTP_OIDC_ISS&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;any_one_of&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;https://aai.egi.eu/auth/realms/egi&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;https://aai.egi.eu/oidc/&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a40000>```shell</span>
</span></span><span style=display:flex><span><span style=color:#a40000>$</span> <span style=color:#a40000>openstack</span> <span style=color:#a40000>mapping</span> <span style=color:#a40000>set</span> <span style=color:#a40000>--rules</span> <span style=color:#a40000>mapping.egi.json</span> <span style=color:#a40000>egi-mapping</span>
</span></span></code></pre></div></li></ol><p>As the new issuer is included in the <code>remote-id</code> configuration of the Keystone
identity provider, there should not be any changes in your users, they will be
still be able to manage owned resources after the change.</p><div class="text-muted mt-5 pt-3 border-top">Last modified
August 23, 2022
by
<a href=mailto:enol.fernandez@egi.eu>Enol Fernández</a>
: <a href=https://github.com/EGI-Federation/documentation/commit/8d1c17a0bce26dec0f2a6de3b00430e091f463f1>Remind to apply mappings (#486)</a></div></div></main></div></div><footer class="bg-dark py-3 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item footer-usr-link mx-2 h3" data-toggle=tooltip data-placement=top title="Community discussions" aria-label="Community discussions"><a class=text-white target=_blank rel=noopener href=https://community.egi.eu aria-label="Community discussions"><i class="fa fa-comments"></i></a></li><li class="list-inline-item footer-usr-link mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/EGI_eInfra aria-label=Twitter><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item github mx-0"><a class=github-button href=https://github.com/EGI-Federation/documentation data-icon=octicon-star data-show-count=true aria-label="Star EGI documentation on GitHub">Stars</a></li><li class="list-inline-item github mx-0"><a class=github-button href=https://github.com/EGI-Federation/documentation/fork data-icon=octicon-repo-forked data-show-count=true aria-label="Fork EGI documentation on GitHub">Forks</a></li><li class="list-inline-item footer-dev-link mx-2 h3" style=vertical-align:top data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/EGI-Federation aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 EGI Foundation. All rights reserved.</small><br><small class=ml-1><a href=https://www.egi.eu/privacy-policy/ target=_blank rel=noopener>Privacy Policy</a></small><br><small><a href=../../../../about/>About EGI Documentation</a></small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/mermaid@8.9.2/dist/mermaid.min.js integrity=sha384-uQikAXnCAqsMb3ygtdqBYvcwvHUkzGIpjdGyy9owhURXHUxLC5LgTcSxJQH/RzjK crossorigin=anonymous></script>
<script src=../../../../js/deflate.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.css integrity=sha384-Cqd8ihRLum0CCg8rz0hYKPoLZ3uw+gES2rXQXycqnL5pgVQIflxAUDS7ZSjITLb5 crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.js integrity=sha384-1Or6BdeNQb0ezrmtGeqQHFpppNd7a/gw29xeiSikBbsb44xu3uAo8c7FwbF5jhbd crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/mhchem.min.js integrity=sha384-LIgAiYlGSAdpNC9+YDjDPF6JeS/RRIumtNo0CmyQERZ/+g0h9MbuYQwf/5pQ4Y4M crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous onload=renderMathInElement(document.body,null)></script>
<script src=../../../../js/main.min.d0b5594a58881d76643839c90ace353d66139058f0ee49bd0e7077fae617cb89.js integrity="sha256-0LVZSliIHXZkODnJCs41PWYTkFjw7km9DnB3+uYXy4k=" crossorigin=anonymous></script>
<script src=../../../../js/prism.js></script></body></html>